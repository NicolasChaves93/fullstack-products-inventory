<div class="container-material">
  <!-- Toolbar superior -->
  <mat-toolbar color="accent" class="page-toolbar">
    <span>GESTIÓN DE PRODUCTOS E INVENTARIO</span>
    <span class="spacer"></span>
  </mat-toolbar>

  <div class="grid-layout">
    <!-- Formulario de creación -->
    <aside class="left-col">
      <mat-card class="creation-card">
        <mat-card-header>
          <mat-card-title>Crear Nuevo Producto</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <form (ngSubmit)="handleCreateProduct()" class="product-form">
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Nombre del Producto</mat-label>
                <input matInput [(ngModel)]="newProduct.name" name="name" required>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Código (ID)</mat-label>
                <input matInput [(ngModel)]="newProduct.code" name="code" required>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Precio</mat-label>
                <input matInput type="number" [(ngModel)]="newProduct.price" name="price" required min="0">
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Descripción</mat-label>
                <textarea matInput [(ngModel)]="newProduct.description" name="description" required></textarea>
              </mat-form-field>
            </div>

            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" [disabled]="loading">
                <mat-icon class="btn-icon">add</mat-icon>
                <span>Crear Producto</span>
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>
    </aside>

    <!-- Catálogo de productos -->
    <section class="right-col">
      <!-- Encabezado visual -->
      <div class="catalog-header">
        <div class="catalog-text">
          <h2 class="catalog-title">Catálogo de Productos</h2>
          <span class="catalog-subtitle">Total Productos: {{ productPage?.totalElements || 0 }}</span>
        </div>
      </div>

      <mat-card class="list-card">
        <mat-card-content>
          <div *ngIf="loading" class="loading-spinner">
            Cargando productos...
          </div>

          <div *ngIf="!loading && products.length === 0" class="no-data">
            No se encontraron productos en el catálogo.
          </div>

          <div class="table-wrapper mat-elevation-z2">
            <table mat-table [dataSource]="products" *ngIf="products.length > 0 && !loading" class="mat-table">
              <!-- Código -->
              <ng-container matColumnDef="code">
                <th mat-header-cell *matHeaderCellDef>Código</th>
                <td mat-cell *matCellDef="let product"> {{ product.code }} </td>
              </ng-container>

              <!-- Nombre / Descripción -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Nombre / Descripción</th>
                <td mat-cell *matCellDef="let product">
                  <div class="name-block">
                    <strong>{{ product.name }}</strong>
                    <p class="description-text">{{ product.description }}</p>
                  </div>
                </td>
              </ng-container>

              <!-- Precio -->
              <ng-container matColumnDef="price">
                <th mat-header-cell *matHeaderCellDef>Precio</th>
                <td mat-cell *matCellDef="let product"> ${{ product.price | number:'1.2-2' }} </td>
              </ng-container>

              <!-- Estado -->
              <ng-container matColumnDef="active">
                <th mat-header-cell *matHeaderCellDef>Estado</th>
                <td mat-cell *matCellDef="let product">
                  <mat-slide-toggle
                    [checked]="product.active"
                    (change)="toggleActiveStatus(product)"
                    [color]="product.active ? 'primary' : 'warn'">
                    {{ product.active ? 'Activo' : 'Inactivo' }}
                  </mat-slide-toggle>
                </td>
              </ng-container>

              <!-- Acciones -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let product">
                  <button mat-stroked-button color="warn" (click)="handleDelete(product.id)">
                    <mat-icon>delete</mat-icon>
                    <span>Eliminar</span>
                  </button>
                </td>
              </ng-container>

              <!-- Inventario -->
              <ng-container matColumnDef="inventory">
                <th mat-header-cell *matHeaderCellDef>Gestión de Inventario</th>
                <td mat-cell *matCellDef="let product">
                  <app-inventory-manager [productCode]="product.code"></app-inventory-manager>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>

          <div class="pagination-footer">
            <mat-paginator [length]="productPage?.totalElements || 0"
                           [pageSize]="pageSize"
                           [pageSizeOptions]="pageSizeOptions"
                           [pageIndex]="currentPage"
                           (page)="onPage($event)">
            </mat-paginator>
          </div>
        </mat-card-content>
      </mat-card>
    </section>
  </div>
</div>